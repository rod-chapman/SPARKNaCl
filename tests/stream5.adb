with SPARKNaCl;        use SPARKNaCl;
with SPARKNaCl.Core;   use SPARKNaCl.Core;
with SPARKNaCl.Debug;  use SPARKNaCl.Debug;
with SPARKNaCl.Stream; use SPARKNaCl.Stream;
procedure Stream5
is
   --  Example and Test Vector from RFC 8439

   Firstkey : constant ChaCha20_Key :=
     Construct ((16#00#, 16#01#, 16#02#, 16#03#,
                 16#04#, 16#05#, 16#06#, 16#07#,
                 16#08#, 16#09#, 16#0a#, 16#0b#,
                 16#0c#, 16#0d#, 16#0e#, 16#0f#,
                 16#10#, 16#11#, 16#12#, 16#13#,
                 16#14#, 16#15#, 16#16#, 16#17#,
                 16#18#, 16#19#, 16#1a#, 16#1b#,
                 16#1c#, 16#1d#, 16#1e#, 16#1f#));

   Nonce_IETF : constant ChaCha20_IETF_Nonce :=
     (16#00#, 16#00#, 16#00#, 16#00#, 16#00#, 16#00#,
      16#00#, 16#4a#, 16#00#, 16#00#, 16#00#, 16#00#);

   Initial_Counter_IETF : U32 := 1;

   M : constant Byte_Seq (0 .. 113) := (
       16#4c#, 16#61#, 16#64#, 16#69#, 16#65#, 16#73#, 16#20#, 16#61#,
       16#6e#, 16#64#, 16#20#, 16#47#, 16#65#, 16#6e#, 16#74#, 16#6c#,
       16#65#, 16#6d#, 16#65#, 16#6e#, 16#20#, 16#6f#, 16#66#, 16#20#,
       16#74#, 16#68#, 16#65#, 16#20#, 16#63#, 16#6c#, 16#61#, 16#73#,
       16#73#, 16#20#, 16#6f#, 16#66#, 16#20#, 16#27#, 16#39#, 16#39#,
       16#3a#, 16#20#, 16#49#, 16#66#, 16#20#, 16#49#, 16#20#, 16#63#,
       16#6f#, 16#75#, 16#6c#, 16#64#, 16#20#, 16#6f#, 16#66#, 16#66#,
       16#65#, 16#72#, 16#20#, 16#79#, 16#6f#, 16#75#, 16#20#, 16#6f#,
       16#6e#, 16#6c#, 16#79#, 16#20#, 16#6f#, 16#6e#, 16#65#, 16#20#,
       16#74#, 16#69#, 16#70#, 16#20#, 16#66#, 16#6f#, 16#72#, 16#20#,
       16#74#, 16#68#, 16#65#, 16#20#, 16#66#, 16#75#, 16#74#, 16#75#,
       16#72#, 16#65#, 16#2c#, 16#20#, 16#73#, 16#75#, 16#6e#, 16#73#,
       16#63#, 16#72#, 16#65#, 16#65#, 16#6e#, 16#20#, 16#77#, 16#6f#,
       16#75#, 16#6c#, 16#64#, 16#20#, 16#62#, 16#65#, 16#20#, 16#69#,
       16#74#, 16#2e#);

   C : Byte_Seq (0 .. 113);
begin
   -- Keystream only
   ChaCha20_IETF (C, Nonce_IETF, Firstkey, Initial_Counter_IETF);
   DH ("Keystream only. See RFC 8539 section 2.4.2", C);

   -- Message ciphertext
   ChaCha20_IETF_Xor (C, M, Nonce_IETF, Firstkey, Initial_Counter_IETF);
   DH ("Ciphertext. See RFC 8539 section 2.4.2", C);
end Stream5;
